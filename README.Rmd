---
title: "Análisis de datos atmosféricos"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Instalar paquete S5Processor

```{r}
#devtools::install_github("MBalthasar/S5Processor")
```

## Cargar paquetes

```{r}
library(S5Processor)
library(raster)
```

Cargar datos

```{r}
f <- 'S5P_NRTI_L2__NO2____20191209T173610_20191209T174110_11170_01_010302_20191209T182308.nc'
nc <- ncdf4::nc_open(f)
vars <- attributes(nc$var)$names
p <- 6
p
ncr <- S5P_process(input = f, product = p)
ncr
```

## Exportar

```{r}
writeRaster(ncr, paste0(gsub('.nc', '', f), '_', gsub('/','_', vars[p]), '.tif'), overwrite=T)
```

## Instalar sentinelsat (API de Sentinel)

```{bash}
git clone https://github.com/sentinelsat/sentinelsat.git
sudo apt install python-pip
pip install sentinelsat
sudo find / -type f -iname '*sentinelsat*'
/home/mirel/.local/bin/sentinelsat -u s5pguest -p s5pguest -g /home/mirel/Documents/analisis-atmosfericos-mirel/descargas/rd.geojson --sentinel 5 -s 20181018 -e 20191018 --url "https://s5phub.copernicus.eu/dhus" --producttype L2__NO2___
#Para descargar, agrega flag -d, ejemplo:
/home/mirel/.local/bin/sentinelsat -u s5pguest -p s5pguest -d -g /home/mirel/Documents/analisis-atmosfericos-mirel/descargas/rd.geojson --sentinel 5 -s 20181018 -e 20181019 --url "https://s5phub.copernicus.eu/dhus" --producttype L2__NO2___
```